# Alt-1, Alt-2 快速选择发件箱
macro generic "<esc>1" ":set from='Sun Wuan <sunwuan@cn.fujitsu.com>'"
macro generic "<esc>2" ":set from='Vern Sun <s5unty@gmail.com>'"
macro compose "<esc>1" ":push <edit-from><enter><kill-line>Sun Wuan <sunwuan@cn.fujitsu.com><enter>"
macro compose "<esc>2" ":push <edit-from><enter><kill-line>Vern Sun <s5unty@gmail.com><enter>"

# http://wiki.mutt.org/?UserStory/SearchingMail
# nmzmail/mairix 都不支持中文
macro generic S "<shell-escape>nmzmail<return><esc>c~/.nmzmail/result<return>" "Search via nmzmail"

# 切换邮箱和发送邮件的默认快捷键都是 y，容易误发邮件
macro index "c" "<change-folder>?<toggle-mailboxes>"
macro pager "c" "<change-folder>?<toggle-mailboxes>"

# 通知 fetchmail 立刻检查新邮件
macro index G "<shell-escape>fetchmail<enter>" 'retrieve mail from POP server'
macro pager G "<shell-escape>fetchmail<enter>" 'retrieve mail from POP server'

# 下载/签名 gpg 公钥
macro pager J "!gpg --keyserver pgp.mit.edu --recv-key " "Get PGP Key"
macro pager K "!gpg --lsign-key " "Sign PGP Key"

# 标记所有新邮件为已读(测试和新建邮箱时)
macro index \cr "<collapse-all><tag-pattern>~(~N)<enter><tag-prefix><clear-flag>N<untag-pattern>.<enter><collapse-all><current-bottom>"

macro browser h "<first-entry><select-entry>"

# 快速保存附件
macro attach s "<save-entry><kill-line>/tmp/<enter>a"

# http://www.nixternal.com/mark-e-mails-in-mutt-as-tasks-in-taskwarrior/
# https://github.com/ValiValpas/taskopen
macro index,pager "<esc>t" "<pipe-message>~/.mutt/mutt2task<enter>\
          :set wait_key=no<enter>\
          :set pipe_decode=no<enter>\
          <pipe-message>~/.mutt/mess2task<enter>\
          :set wait_key=yes<enter>\
          :set pipe_decode=yes<enter>" "Task"

# 显示曾经被我回复过的邮件(~Q)，包括我的回复(~P)
macro index "<F12>" "<limit>~Q | ~P<enter>"
# 只显示这两天的邮件
macro index "<F11>" "<limit>~d `date -d '1 days ago' +%d/%m`-<enter>"

macro index,pager A "<pipe-message>abook --add-email<return>" "add the sender address to abook"

# 避免切换折叠后导致底部留白的问题
macro index Z "<collapse-all><current-bottom>"
macro index z "<collapse-thread>"

# 邮件备注
macro index,pager "<Return>" "\
          :set pipe_decode=no<enter>\
          :set wait_key=no<enter>\
          <pipe-message>~/.mutt/mutt2note<enter>\
          :set wait_key=yes<enter>\
          :set pipe_decode=yes<enter>\
          :set <enter>" "Note"

